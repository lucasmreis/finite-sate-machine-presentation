## Planning, Collaborating, And Finite State Machines

---

## Lucas Reis

Currently at Zocdoc in NYC ðŸ‡ºðŸ‡¸

Originally from Brazil ðŸ‡§ðŸ‡·

_@iamlucasmreis_

<img style={{ height: "80px" }} src="static/zocdoc.png" />

---

Did you go from 

## Infinite Planning

to 

## No Planning At All

?

---

We used to have months of planning and no early feedback from our stakeholders, it was very inneficient...  

---

### ...but we are getting too far to the other side of the pendulum

---

_Wait, are you bringing back WATERFALL???_

<img style={{ width: 500 }} src="static/scared.gif" />

---

No, I'm only claiming we need **some** planning

_not two months, but something from two hours to two days!_

---

The reasoning:

1. Coding is more **costly** than planning
2. We are able to solve **big problems** and catch bugs with planning
3. During planning we're able to leverage knowledge of **non-coders** too 

---

The best planning tools are:

* **High-level** enough to be able to be developed by non-coders
* **Low-level enough** to actually help you with your code

---

### Finite State Machines Satisfy These Requirements!

(more specifically _Statecharts_)

---

Statecharts deal better with complexity 

* Add _modularity_ to regular FSMs
* Easier to design complex UIs
* Avoid state explosions

---

### Let's implement a UI component using statecharts!

---

### Health Insurance Picker _(inspired by Zocdoc)_

* Patient needs to choose a **Carrier** and a **Plan** accepted by the Carrier
* The lists are fetched **asynchronously**
* Clicking in the input opens a **dropdown** with the options
* Clicking **outside** the dropdown closes it
* It is possible to **reset** the selection
* It is possibe to have a **partial** selection

---

## SketchSystems

Great starting point for sketching your Statechart

---

<img src="static/sketch-systems-code.png" />

---

<iframe 
    src="https://sketch.systems/lucasmreis/sketch/13f3650ed126fd197855716a28588da6"
    frameborder="no"
    width="400"
    height="600">
</iframe>

---

## xstate/xviz

Is becoming the JS standard for working with Statecharts, framework agnostic

---

import { Code } from './components'

<Code>
{`
{
  "key": "Oven",
  "initial": "off",
  "states": {
    "off": {
      "on": {
        "BAKE_PRESSED": "heating"
      }
    },
    "heating": {
      "on": {
        "OFF_PRESSED": "off"
      }
    }
  }
}
`}
</Code>

---

<img style={{ height: "50vh" }} src="machines/oven.png" />

---

<img style={{ height: "90vh" }} src="machines/insurance-picker.png" />

---

## React Automata

Uses `xstate` to actually manage your React components

---
import SyntaxHighlighter from 'react-syntax-highlighter/prism'
import { darcula } from 'react-syntax-highlighter/styles/prism'

<SyntaxHighlighter language='jsx' style={darcula}>
{`const InsurancePicker = withStateMachine(statechart)(Container);`} 
</SyntaxHighlighter>

---

<div style={{ fontSize: '0.6em' }}>
<SyntaxHighlighter language='jsx' style={darcula}>
{`class Container extends React.Component {
  state = {
    selectedCarrier: null,
    selectedPlan: null,
    carriers: [],
    plans: []
  };
`}
</SyntaxHighlighter>
</div>

---

import { ImageV } from './components'

<ImageV src="static/whole-component.png"/>

---

_AND WE'RE DONE!_

---

<iframe 
    src="https://codesandbox.io/embed/7y5286moy1"  
    style={{ width: 500, borderRadius: "4px", overflow: "hidden", height: 500 }}
    sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin">
</iframe>

---

### Key Takeaways

---

## Preciseness of specs
## Correctness of code

---

* More time collaborating with non-coders!
* Less noise in code, less unimportant state handling
* More declarative code, no if statements

---

### Future

* More vizualization tools
* More ways to integrate with JS 
* More tools to assert correctness

---

### Thank you very much!

Lucas Reis

_@iamlucasmreis_

<img style={{ height: "100px" }} src="static/zocdoc.png" />

---

### Important links:

* https://statecharts.github.io/
* https://spectrum.chat/statecharts
* https://sketch.systems/
* https://github.com/davidkpiano/xstate
* https://github.com/MicheleBertoli/react-automata
* https://github.com/avaragado/xstateful
* https://github.com/avaragado/xstateful-react

